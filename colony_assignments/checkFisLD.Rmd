---
title: "Check $F_{is}$ and LD of microsatellite loci"
author: "Jenna Melanson"
date: "2025-06-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/Users/jenna1/Documents/UBC/bombus_project/fv_landscapeforaging")

# prep workspace
rm(list = ls())
setwd("/Users/jenna1/Documents/UBC/bombus_project/fv_landscapeforaging")

# first, load in packages
source('colony_assignments/src/init.R')
source('colony_assignments/src/joinFunctions.R')
library(dplyr)
library(tidyr)
library(stringr)
library(rcolony)
library(genepop)
library(data.table)
library(cowplot)
library(raster)

# load in raw data

# for mixtus
mtestalleles2022 = read.csv("data/merged_by_year/csvs/mixtus_2022_scores.csv")
mtestalleles2022 = mtestalleles2022[,-1]
mtestalleles2023 = read.csv("data/merged_by_year/csvs/mixtus_2023_scores.csv")
mtestalleles2023 = mtestalleles2023[,-1]

# for impatiens
itestalleles2022 = read.csv("data/merged_by_year/csvs/impatiens_2022_scores.csv")
itestalleles2022 = itestalleles2022[,-1]
itestalleles2023 = read.csv("data/merged_by_year/csvs/impatiens_2023_scores.csv")
itestalleles2023 = itestalleles2023[,-1]
```

## Goals
To assess the quality of our microsatellites for sibling-ship assignment, we first calculated $F_{is}$ for all loci x site x year x species groups using the Weir & Cockerham method in GENEPOP [insert citation].

```{r calculate Fis, include = FALSE}
######################################
# Prep BOMBUS MIXTUS for genepop
#####################################

#combine columns for each locus
ms_m22 = data.table(mtestalleles2022)
ms_m22[ms_m22 ==0] <- "000"


i1 <- seq(1, length(ms_m22)-1, 2)
i2 <- seq(2, length(ms_m22)-1, 2)
msgenepop_m22 = ms_m22[, Map(paste,
                             .SD[, i1, with = FALSE], .SD[, i2, with = FALSE], 
                             MoreArgs = list(sep="")), 
                       by = "barcode_id"]
colnames(msgenepop_m22) = c("barcode_id", "BT10", "BTMS0104", "BTMS0057", "BTMS0086",
                            "BTMS0066", "BTMS0062", "BTMS0136","BTERN01", "BTMS0126", 
                            "BTMS0059", "BL13", "BTMS0083", "B126")

#sort allele table by barcode ID
msgenepop_m22 <- msgenepop_m22[order(msgenepop_m22$barcode_id),]
msgenepop_m22$site = substring(msgenepop_m22$barcode_id, 1, 1)

haplotypes_m22 <- as.data.frame(paste(msgenepop_m22$site, ","," ", 
                                      msgenepop_m22$BT10," ", msgenepop_m22$BTMS0104, " ",
                                      msgenepop_m22$BTMS0057," ", msgenepop_m22$BTMS0086, " ",
                                      msgenepop_m22$BTMS0066," ", msgenepop_m22$BTMS0062, " ",
                                      msgenepop_m22$BTMS0136," ", msgenepop_m22$BTERN01, " ",
                                      msgenepop_m22$BTMS0126," ", msgenepop_m22$BTMS0059," ",
                                      msgenepop_m22$BL13," ", msgenepop_m22$BTMS0083, " ",
                                      msgenepop_m22$B126,
                                      sep = ""))

#Build the Genepop format
sink("data/genepop/ms_genepop_format_mixtus2022.txt")
cat("Title: B. mixtus workers (2022) \n")
cat("BT10 \n")
cat("BTMS0104 \n")
cat("BTMS0057 \n")
cat("BTMS0086 \n")
cat("BTMS0066 \n")
cat("BTMS0062 \n")
cat("BTMS0136 \n")
cat("BTERN01 \n")
cat("BTMS0126 \n")
cat("BTMS0059 \n")
cat("BL13 \n")
cat("BTMS0083 \n")
cat("B126 \n")
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m22[substring(haplotypes_m22[,1],1,1) == "E",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m22[substring(haplotypes_m22[,1],1,1) == "W",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m22[substring(haplotypes_m22[,1],1,1) == "S",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m22[substring(haplotypes_m22[,1],1,1) == "N",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m22[substring(haplotypes_m22[,1],1,1) == "P",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m22[substring(haplotypes_m22[,1],1,1) == "H",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
sink()


######################################
# Run genepop on samples
#####################################

#test for HWE
test_HW("data/genepop/ms_genepop_format_mixtus2022.txt", which="Proba", "data/genepop/mixtusHWE2022.txt.D")

#test for LD
test_LD("data/genepop/ms_genepop_format_mixtus2022.txt","data/genepop/mixtusLD2022.txt.DIS")


######################################
# Repeat for 2023 mixtus !
#####################################

##### Prepare alleles table for genepop
#combine columns for each locus
ms_m23 = data.table(mtestalleles2023)
ms_m23[ms_m23 ==0] <- "000"

i1 <- seq(1, length(ms_m23)-1, 2)
i2 <- seq(2, length(ms_m23)-1, 2)
msgenepop_m23 = ms_m23[, Map(paste,
                             .SD[, i1, with = FALSE], .SD[, i2, with = FALSE], 
                             MoreArgs = list(sep="")), 
                       by = "barcode_id"]
colnames(msgenepop_m23) = c("barcode_id", "BT10", "BTMS0104", "BTMS0057", "BTMS0086",
                            "BTMS0066", "BTMS0062", "BTMS0136","BTERN01", "BTMS0126", 
                            "BTMS0059", "BL13", "BTMS0083", "B126")


#select and join alleles

#sort allele table by barcode ID
msgenepop_m23 <- msgenepop_m23[order(msgenepop_m23$barcode_id),]
msgenepop_m23$site = substring(msgenepop_m23$barcode_id, 1, 1)

haplotypes_m23 <- as.data.frame(paste(msgenepop_m23$site, ","," ", 
                                      msgenepop_m23$BT10," ", msgenepop_m23$BTMS0104, " ",
                                      msgenepop_m23$BTMS0057," ", msgenepop_m23$BTMS0086, " ",
                                      msgenepop_m23$BTMS0066," ", msgenepop_m23$BTMS0062, " ",
                                      msgenepop_m23$BTMS0136," ", msgenepop_m23$BTERN01, " ",
                                      msgenepop_m23$BTMS0126," ", msgenepop_m23$BTMS0059," ",
                                      msgenepop_m23$BL13," ", msgenepop_m23$BTMS0083, " ",
                                      msgenepop_m23$B126,
                                      sep = ""))

#Build the Genepop format
sink("data/genepop/ms_genepop_format_mixtus2023.txt")
cat("Title: B. mixtus workers (2023) \n")
cat("BT10 \n")
cat("BTMS0104 \n")
cat("BTMS0057 \n")
cat("BTMS0086 \n")
cat("BTMS0066 \n")
cat("BTMS0062 \n")
cat("BTMS0136 \n")
cat("BTERN01 \n")
cat("BTMS0126 \n")
cat("BTMS0059 \n")
cat("BL13 \n")
cat("BTMS0083 \n")
cat("B126 \n")
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m23[substring(haplotypes_m23[,1],1,1) == "E",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m23[substring(haplotypes_m23[,1],1,1) == "W",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m23[substring(haplotypes_m23[,1],1,1) == "S",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m23[substring(haplotypes_m23[,1],1,1) == "N",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m23[substring(haplotypes_m23[,1],1,1) == "P",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_m23[substring(haplotypes_m23[,1],1,1) == "H",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
sink()


######################################
# Run genepop on samples
#####################################

#test for HWE
test_HW("data/genepop/ms_genepop_format_mixtus2023.txt", 
        which="Proba", 
        "data/genepop/mixtusHWE2023.txt.D")

#test for LD
test_LD("data/genepop/ms_genepop_format_mixtus2023.txt",
        "data/genepop/mixtusLD2023.txt.DIS")


######################################
# Repeat for BOMBUS IMPATIENS
######################################

######################################
# Prep alleles table for genepop
#####################################

### first for 2022! 
#combine columns for each locus
ms_i22 = data.table(itestalleles2022)
ms_i22[ms_i22 ==0] <- "000"


i1 <- seq(1, length(ms_i22)-1, 2)
i2 <- seq(2, length(ms_i22)-1, 2)
msgenepop_i22 = ms_i22[, Map(paste,
                         .SD[, i1, with = FALSE], .SD[, i2, with = FALSE], 
                         MoreArgs = list(sep="")), 
                   by = "barcode_id"]
colnames(msgenepop_i22) = c("barcode_id", "BT10", "B96", "BTMS0059", "BTMS0081",
                        "BL13", "BTMS0062", "B126", "BTERN01","B124", "BTMS0057", 
                        "BT30", "B10", "BTMS0083", "BTMS0073", "BT28")


#select and join alleles

#sort allele table by barcode ID
msgenepop_i22 <- msgenepop_i22[order(msgenepop_i22$barcode_id),]
msgenepop_i22$site = substring(msgenepop_i22$barcode_id, 1, 1)

haplotypes_i22 <- as.data.frame(paste(msgenepop_i22$site, ","," ", 
                                      msgenepop_i22$BT10," ", msgenepop_i22$B96, " ",
                                      msgenepop_i22$BTMS0059," ", msgenepop_i22$BTMS0081, " ",
                                      msgenepop_i22$BL13," ", msgenepop_i22$BTMS0062, " ",
                                      msgenepop_i22$B126," ", msgenepop_i22$BTERN01, " ",
                                      msgenepop_i22$B124," ", msgenepop_i22$BTMS0057," ",
                                      msgenepop_i22$BT30," ", msgenepop_i22$B10, " ",
                                      msgenepop_i22$BTMS0083," ", msgenepop_i22$BTMS0073," ",
                                      msgenepop_i22$BT28,
                                  sep = ""))

#Build the Genepop format
sink("data/genepop/ms_genepop_format_impatiens2022.txt")
cat("Title: B. impatiens workers (2022) \n")
cat("BT10 \n")
cat("B96 \n")
cat("BTMS0059 \n")
cat("BTMS0081 \n")
cat("BL13 \n")
cat("BTMS0062 \n")
cat("B126 \n")
cat("BTERN01 \n")
cat("B124 \n")
cat("BTMS0057 \n")
cat("BT30 \n")
cat("B10 \n")
cat("BTMS0083 \n")
cat("BTMS0073 \n")
cat("BT28 \n")
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i22[substring(haplotypes_i22[,1],1,1) == "E",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i22[substring(haplotypes_i22[,1],1,1) == "W",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i22[substring(haplotypes_i22[,1],1,1) == "S",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i22[substring(haplotypes_i22[,1],1,1) == "N",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i22[substring(haplotypes_i22[,1],1,1) == "P",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i22[substring(haplotypes_i22[,1],1,1) == "H",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
sink()


# then again, for 2023!
#combine columns for each locus
ms_i23 = data.table(itestalleles2023)
ms_i23[ms_i23 ==0] <- "000"


i1 <- seq(1, length(ms_i23)-1, 2)
i2 <- seq(2, length(ms_i23)-1, 2)
msgenepop_i23 = ms_i23[, Map(paste,
                             .SD[, i1, with = FALSE], .SD[, i2, with = FALSE], 
                             MoreArgs = list(sep="")), 
                       by = "barcode_id"]
colnames(msgenepop_i23) = c("barcode_id", "BT10", "B96", "BTMS0059", "BTMS0081",
                            "BL13", "BTMS0062", "B126", "BTERN01","B124", "BTMS0057", 
                            "BT30", "B10", "BTMS0083", "BTMS0073", "BT28")


#select and join alleles

#sort allele table by barcode ID
msgenepop_i23 <- msgenepop_i23[order(msgenepop_i23$barcode_id),]
msgenepop_i23$site = substring(msgenepop_i23$barcode_id, 1, 1)

haplotypes_i23 <- as.data.frame(paste(msgenepop_i23$site, ","," ", 
                                      msgenepop_i23$BT10," ", msgenepop_i23$B96, " ",
                                      msgenepop_i23$BTMS0059," ", msgenepop_i23$BTMS0081, " ",
                                      msgenepop_i23$BL13," ", msgenepop_i23$BTMS0062, " ",
                                      msgenepop_i23$B126," ", msgenepop_i23$BTERN01, " ",
                                      msgenepop_i23$B124," ", msgenepop_i23$BTMS0057," ",
                                      msgenepop_i23$BT30," ", msgenepop_i23$B10, " ",
                                      msgenepop_i23$BTMS0083," ", msgenepop_i23$BTMS0073," ",
                                      msgenepop_i23$BT28,
                                      sep = ""))

#Build the Genepop format
sink("data/genepop/ms_genepop_format_impatiens2023.txt")
cat("Title: B. impatiens workers (2023) \n")
cat("BT10 \n")
cat("B96 \n")
cat("BTMS0059 \n")
cat("BTMS0081 \n")
cat("BL13 \n")
cat("BTMS0062 \n")
cat("B126 \n")
cat("BTERN01 \n")
cat("B124 \n")
cat("BTMS0057 \n")
cat("BT30 \n")
cat("B10 \n")
cat("BTMS0083 \n")
cat("BTMS0073 \n")
cat("BT28 \n")
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i23[substring(haplotypes_i23[,1],1,1) == "E",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i23[substring(haplotypes_i23[,1],1,1) == "W",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i23[substring(haplotypes_i23[,1],1,1) == "S",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i23[substring(haplotypes_i23[,1],1,1) == "N",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i23[substring(haplotypes_i23[,1],1,1) == "P",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
invisible(apply(as.data.frame(haplotypes_i23[substring(haplotypes_i23[,1],1,1) == "H",]), 1,function(x) cat(x,"\n")))
cat("Pop \n")
sink()

######################################
# Run genepop on samples
#####################################

#test for HWE
test_HW("data/genepop/ms_genepop_format_impatiens2022.txt", which="Proba", "data/genepop/impatiensHWE2022.txt.D")
test_HW("data/genepop/ms_genepop_format_impatiens2023.txt", which="Proba", "data/genepop/impatiensHWE2023.txt.D")

#test for LD
test_LD("data/genepop/ms_genepop_format_impatiens2022.txt","data/genepop/impatiensLD2022.txt.DIS")
test_LD("data/genepop/ms_genepop_format_impatiens2023.txt","data/genepop/impatiensLD2023.txt.DIS")

```

The distributions of $F_{is}$ estimates for each species x site are shown below.

```{r read in Fis values for each species, echo = FALSE}

# first, mixtus 2022
mix2022HWElines = readLines("data/genepop/mixtusHWE2022.txt.D")
split_mixHWE2022 <- strsplit(mix2022HWElines, "\\s+")

# pull out the estimates for each site
mixHWE2022_east = as.data.frame(do.call(rbind, split_mixHWE2022[269:281]))
mixHWE2022_east$site = "ED"
mixHWE2022_west = as.data.frame(do.call(rbind, split_mixHWE2022[294:306]))
mixHWE2022_west$site = "W"
mixHWE2022_south = as.data.frame(do.call(rbind, split_mixHWE2022[319:331]))
mixHWE2022_south$site = "SD"
mixHWE2022_harvie = as.data.frame(do.call(rbind, split_mixHWE2022[394:406]))
mixHWE2022_harvie$site = "HR"
mixHWE2022_nico = as.data.frame(do.call(rbind, split_mixHWE2022[344:356]))
mixHWE2022_nico$site = "NR"
mixHWE2022_pitt = as.data.frame(do.call(rbind, split_mixHWE2022[369:381]))
mixHWE2022_pitt$site = "PM"

mixHWE2022 = rbind(mixHWE2022_east, mixHWE2022_harvie, mixHWE2022_nico, mixHWE2022_pitt, mixHWE2022_south, mixHWE2022_west)
colnames(mixHWE2022) = c("locus", "pval", "SE", "FisWC", "FisRH", "steps", "switches", "site")
mixHWE2022$year = 2022



## next, for mixtus 2023
mix2023HWElines = readLines("data/genepop/mixtusHWE2023.txt.D")
split_mixHWE2023 <- strsplit(mix2023HWElines, "\\s+")

# pull out the estimates for each site
mixHWE2023_east = as.data.frame(do.call(rbind, split_mixHWE2023[269:281]))
mixHWE2023_east$site = "ED"
mixHWE2023_west = as.data.frame(do.call(rbind, split_mixHWE2023[294:306]))
mixHWE2023_west$site = "W"
mixHWE2023_south = as.data.frame(do.call(rbind, split_mixHWE2023[319:331]))
mixHWE2023_south$site = "SD"
mixHWE2023_harvie = as.data.frame(do.call(rbind, split_mixHWE2023[394:406]))
mixHWE2023_harvie$site = "HR"
mixHWE2023_nico = as.data.frame(do.call(rbind, split_mixHWE2023[344:356]))
mixHWE2023_nico$site = "NR"
mixHWE2023_pitt = as.data.frame(do.call(rbind, split_mixHWE2023[369:381]))
mixHWE2023_pitt$site = "PM"

mixHWE2023 = rbind(mixHWE2023_east, mixHWE2023_harvie, mixHWE2023_nico, mixHWE2023_pitt, mixHWE2023_south, mixHWE2023_west)
colnames(mixHWE2023) = c("locus", "pval", "SE", "FisWC", "FisRH", "steps", "switches", "site")
mixHWE2023$year = 2023

mixHWE = rbind(mixHWE2022, mixHWE2023)


## next, for impatiens 2022!
imp2022HWElines = readLines("data/genepop/impatiensHWE2022.txt.D")
split_impHWE2022 <- strsplit(imp2022HWElines, "\\s+")

# pull out the estimates for each site
impHWE2022_east = as.data.frame(do.call(rbind, split_impHWE2022[305:319]))
impHWE2022_east$site = "ED"
impHWE2022_west = as.data.frame(do.call(rbind, split_impHWE2022[332:346]))
impHWE2022_west$site = "W"
impHWE2022_south = as.data.frame(do.call(rbind, split_impHWE2022[359:373]))
impHWE2022_south$site = "SD"
impHWE2022_harvie = as.data.frame(do.call(rbind, split_impHWE2022[440:454]))
impHWE2022_harvie$site = "HR"
impHWE2022_nico = as.data.frame(do.call(rbind, split_impHWE2022[386:400])[,1:7])
impHWE2022_nico$site = "NR"
impHWE2022_pitt = as.data.frame(do.call(rbind, split_impHWE2022[413:427]))
impHWE2022_pitt$site = "PM"

impHWE2022 = rbind(impHWE2022_east, impHWE2022_harvie, impHWE2022_nico, impHWE2022_pitt, impHWE2022_south, impHWE2022_west)
colnames(impHWE2022) = c("locus", "pval", "SE", "FisWC", "FisRH", "steps", "switches", "site")
impHWE2022$year = 2022



## repeat for impatiens 2023!
imp2023HWElines = readLines("data/genepop/impatiensHWE2023.txt.D")
split_impHWE2023 <- strsplit(imp2023HWElines, "\\s+")

# pull out the estimates for each site
impHWE2023_east = as.data.frame(do.call(rbind, split_impHWE2023[305:319]))
impHWE2023_east$site = "ED"
impHWE2023_west = as.data.frame(do.call(rbind, split_impHWE2023[332:346]))
impHWE2023_west$site = "W"
impHWE2023_south = as.data.frame(do.call(rbind, split_impHWE2023[359:373]))
impHWE2023_south$site = "SD"
impHWE2023_harvie = as.data.frame(do.call(rbind, split_impHWE2023[440:454]))
impHWE2023_harvie$site = "HR"
impHWE2023_nico = as.data.frame(do.call(rbind, split_impHWE2023[386:400]))
impHWE2023_nico$site = "NR"
impHWE2023_pitt = as.data.frame(do.call(rbind, split_impHWE2023[413:427]))
impHWE2023_pitt$site = "PM"

impHWE2023 = rbind(impHWE2023_east, impHWE2023_harvie, impHWE2023_nico, impHWE2023_pitt, impHWE2023_south, impHWE2023_west)
colnames(impHWE2023) = c("locus", "pval", "SE", "FisWC", "FisRH", "steps", "switches", "site")
impHWE2023$year = 2023

impHWE = rbind(impHWE2022, impHWE2023)


```

```{r plot Fis distributions for each species, echo = FALSE}
impHWE$species = "B. impatiens"
mixHWE$species = "B. mixtus"
HWE = rbind(impHWE, mixHWE)
HWE$FisWC = as.numeric(HWE$FisWC)
HWE$locus = as.factor(HWE$locus)

ggplot(HWE, aes(x = FisWC)) +
  geom_histogram(binwidth = 0.02) +
  geom_vline(xintercept = 0, color = "blue", linetype = "dotted") +
  geom_vline(xintercept = -0.1, color = "red", linetype = "dotted") +
  geom_vline(xintercept = 0.1, color = "red", linetype = "dotted") +
  theme_minimal() +
  xlab(expression(F[is] * " (W&C)")) +
  ylab("Count") +
  theme(axis.text.x = element_text(size = 6)) +
  facet_grid(species ~ site)

# ggplot(HWE, aes(x = FisWC)) +
#   geom_histogram() +
#   geom_vline(xintercept = 0, color = "red", linetype = "dotted") +
#   theme_minimal() +
#   facet_grid(species ~ 1)


```

We employed a linear model to determine whether the global mean of $F_{is}$ estimates (across all sites, years, and loci) varied significantly from zero (no inbreeding), and whether $F_{is}$ estimates for any individual locus (across sites, years) varied significantly from the global mean. The presence of inbreeding must be accounted for, if present, during sibling-ship assignment, and $F_{is}$ significantly different from the global mean for a given locus can be indicative of null alleles or other scoring errors.

We modeled $F_{is}$ (W&C) with locus as a fixed predictor, using sum-to-zero coding so that the model intercept represented the global mean $F_{is}$ across loci and the coefficient for each locus represented its difference from the global mean. We then iteratively removed loci which were significantly different from the global mean, starting with the locus with the most significant deviation and re-running the model after each removal (i.e., because removing a locus with a high or low inbreeding coefficient will change the global mean).


```{r mixed effect model of Fis, echo=TRUE}
contrasts(HWE$locus) <- contr.sum

# Then fit model
library(lmerTest)
model <- lmer(FisWC ~ locus + (1 | site) + (1 | year), data = HWE)
model <- lmer(FisWC ~ locus + (1 | site) + (1 | year), data = HWE)
summary(model)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
